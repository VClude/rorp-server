<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <link href="styles.css" rel="stylesheet">
  <link href="index.css" rel="stylesheet">
  <style>
    #yes {
      display: none;
    }

    #yes2 {
      display: none;
    }
  </style>
</head>

<body>
    <div id="yes2">
        <div class="full-screen">
            <div class="shop-container">
                <!-- header -->
                <div class="header">
                    <h1>Distributor</h1>
                    <div class="btnQuit"><img class="close" src="img/close.png" alt="Quit" /></div>
                </div>
                <!-- home -->
                <div class="body home">
                    <div class="card">
                        <div class="image-holder">
                            <img src="img/bread.png" alt="Hambergur">
                        </div>
                        <div class="container">
                            <div class="quantity">
                                <div class="plus-btn btnquantity" name="button" id="plus">
                                    <img src="img/plus.png" alt="" />
                                </div>
                                <div class="number" name="name">1</div>
                                <div class="minus-btn btnquantity" name="button" id="minus">
                                    <img src="img/minus.png" alt="" />
                                </div>
                            </div>
                            <div class="purchase">
                                <div class="buy">Purchase</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
  <div id="yes" class="container">
    <div class="head">
      Cooking Menu
    </div>
    <div class="subtitle">
      SELECT INGREDIENTS
    </div>

    <div class="ingredients iqdropdown">
      <p class="iqdropdown-selection"></p>
      <ul class="iqdropdown-menu">
      </ul>
    </div>
    <button type="button" onclick="cooking()"><strong>COOKING</strong></button>
  </div>
  <script src="nui://game/ui/jquery.js" type="text/javascript"></script>
  <script type="text/javascript">
    var ingredients = {};
    var prices = {}
    var maxes = {}
    var zone = null

    function cooking() {
      $.post('http://rorp_pedagang/cookingNUI', JSON.stringify(ingredients));
      $.post('http://rorp_pedagang/NUIFocusOff');
    }

    function closeMain() {
        $('#yes2').hide();
        $('#yes').hide();
    }

    function openMain() {
        $('#yes2').show();
    }

    function closeAll() {
        $('#yes2').hide();
    }
    $(".close").click(function () {
         $.post('http://rorp_pedagang/quit', JSON.stringify({}));

    });
    $(document).ready(function () {

    });
    $(function () {
      window.onload = function (e) {

        window.addEventListener('message', function (event) {
          var item = event.data;

          if (item.message == 'cook') {
            if (item.display === true) {
              $(".iqdropdown-menu").empty();
              $(".ingredients").unbind();
              ingredients = {};
              for (var i = 0; i < item.inventory.length; i++) {
                var obj = item.inventory[i]
                $(".iqdropdown-menu").append('<li data-id="' + obj.name + '" data-maxcount=' + obj.count +
                  '><div> ' + obj.label + '<span>Tambahkan ' + obj.label +
                  ' ke daftar bahan memasak.</span> </div></li>');
                //Do something
              }
              $(".ingredients").iqDropdown({
                selectionText: 'ingredient',
                textPlural: 'ingredients',
                onChange: function (id, count, totalItems) {
                  ingredients[id] = count
                },
              });
              $('#yes').show();
            } else {
              $('#yes').hide();
            }
          }
          if (item.message == "loadshop") {
              // console.log('yes');
              if (item.clear == true){
			$( ".home" ).empty();
			prices = {}
			maxes = {}
			zone = null
		}
		openMain();
          }

          if (item.message == "hide") {
		closeMain();
	}

	if (item.message == "add"){
		$( ".home" ).append('<div class="card">' +
					'<div class="image-holder">' +
						'<img src="img/' + item.item + '.png" onerror="this.src = \'img/default.png\'" alt="' + item.label + '" style="width:100%">' +
					'</div>' +
					'<div class="containerz">' +
						'<h4><b>' + item.label + '<div class="price">' + item.price + '$' + '</div>' + '</b></h4> ' +
						'<div class="quantity">' +
							'<div class="minus-btn btnquantity" name="' + item.item + '" id="minus">' +
								'<img src="img/minus.png" alt="" />' +
							'</div>' +
							'<div class="number" name="name">1</div>' +
							'<div class="plus-btn btnquantity" name="' + item.item + '" id="plus">' +
								'<img src="img/plus.png" alt="" />' +
							'</div>' +
						'</div>' +
						'<div class="purchase">' +

							'<div class="buy" name="' + item.item + '">Buy</div>' +
						'</div>' +
					'</div>' +
				'</div>');
		prices[item.item] = item.price;
		maxes[item.item] = 99;
		zone = item.loc;
	}


        });

        document.onkeyup = function (data) {
          if (data.which == 27) { // Escape key
            $.post('http://rorp_pedagang/quit', JSON.stringify({}));
            $.post('http://rorp_pedagang/NUIFocusOff');
          }
        };
      };
    });

    $(".home").on("click", ".btnquantity", function () {

      var $button = $(this);
      var $name = $button.attr('name')
      var oldValue = $button.parent().find(".number").text();
      if ($button.get(0).id == "plus") {
        if (oldValue < maxes[$name]) {
          var newVal = parseFloat(oldValue) + 1;
        } else {
          var newVal = parseFloat(oldValue);
        }
      } else {
        // Don't allow decrementing below zero
        if (oldValue > 1) {
          var newVal = parseFloat(oldValue) - 1;
        } else {
          newVal = 1;
        }
      }
      $button.parent().parent().find(".price").text((prices[$name] * newVal) + "$");
      $button.parent().find(".number").text(newVal);

    });

    $(".home").on("click", ".buy", function () {
      var $button = $(this);
      var $name = $button.attr('name')
      var $count = parseFloat($button.parent().parent().find(".number").text());
      $.post('http://rorp_pedagang/purchase', JSON.stringify({
        item: $name,
        count: $count,
        loc: zone
      }));
    });
  </script>

  <script type="text/javascript" src="item-quantity-dropdown.min.js"></script>
  <script src="debounce.min.js" type="text/javascript"></script>
</body>

</html>